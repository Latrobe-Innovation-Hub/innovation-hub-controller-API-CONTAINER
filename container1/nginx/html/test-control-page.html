<!DOCTYPE html>
<html>
<head>
    <title>Room Information</title>
	<style>
        body {
            background-color: #f2f2f2;
            font-family: Arial, sans-serif;
            margin: 0;
            padding: 20px;
        }

        h1 {
            color: #333333;
        }

        form {
            margin-top: 20px;
        }

        label {
            display: block;
            margin-bottom: 5px;
            color: #666666;
        }

        input {
            padding: 10px;
            font-size: 16px;
            border-radius: 4px;
            border: 1px solid #cccccc;
            margin-bottom: 15px;
        }

        button {
            background-color: #4CAF50;
            border: none;
            border-radius: 4px;
            color: #ffffff;
            cursor: pointer;
            font-size: 18px;
            margin-top: 10px;
            padding: 10px 20px;
            transition: background-color 0.3s;
        }

            button:hover {
                background-color: #45a049;
            }

        h2 {
            margin-top: 20px;
            color: #333333;
        }

        pre {
            background-color: #ffffff;
            border-radius: 4px;
            border: 1px solid #cccccc;
            padding: 10px;
            overflow-x: auto;
            text-align: left;
            font-size: 14px;
            line-height: 1.5;
            width: fit-content;
        }

        .dropdown {
            display: none; /* Initially hidden */
        }

		
		.response {
			display: inline-block;
			vertical-align: top;
			margin-top: 10px; /* Adjust the margin as needed */
		}
		
		.pre.response {
    height: 100px; /* Adjust the height as needed */
    overflow-y: auto;
}
    </style>
</head>
<body>
    <h1>Room Information</h1>

    <h2>Rooms:</h2>
    <ul id="roomList"></ul>

    <div id="roomInfo">
        <h2>Room Details:</h2>
        <p><strong>Description:</strong> <span id="roomDescription"></span></p>
    </div>

    <h2>Displays:</h2>
    <ul id="displayList"></ul>

    <h2>Hosts:</h2>
    <ul id="hostList"></ul>

    <h2>PDUs:</h2>
    <ul id="pduList"></ul>
	<div id="outletSettings"></div>


    <!-- Add JavaScript code below to fetch and display room information -->
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script>
    $(document).ready(function () {
        //var base_url = "http://admin:admin@192.168.20.26";
		var base_url = "";
		
		// Initialize an object to store host information with PIDs
		const hostData = {};

        function populateRoomList(rooms) {
            const roomList = $('#roomList');
            roomList.empty();
            rooms.forEach(room => {
                roomList.append(`
                    <li>
                        <button class="roomButton" data-room-code="${room.room_code}">${room.room_code}</button>
                    </li>
                `);
            });
        }

        function updateRoomInfo(roomCode) {
            $.ajax({
                url: base_url + `/api/get_room/${roomCode}`,
                method: 'GET',
                success: function (response) {
                    const roomInfo = response.room_info;

                    $('#roomCode').text(roomInfo.room_code);
                    $('#roomDescription').text(roomInfo.description);

                    $('#displayList').empty();
                    roomInfo.displays.forEach(display => {
					const displayAddressId = display.display_address.replace(/\./g, '_');

                        $('#displayList').append(`
						<li>
							${display.display_name} (ID: ${display.display_address})
							<button class="turnDisplayOn" data-room-code="${roomCode}" data-host-id="${display.display_address}">Turn On</button>
							<button class="turnDisplayOff" data-room-code="${roomCode}" data-host-id="${display.display_address}">Turn Off</button>
							<button class="getDisplayStatus" data-room-code="${roomCode}" data-host-id="${display.display_address}">Status</button>
							<pre class="response" id="displayResponse_${displayAddressId}"></pre>
						</li>
                        `);
                    });
					
					$('#displayList').on('click', '.turnDisplayOn', function () {
						const displayAddress = $(this).data('host-id');
						const roomCode = $(this).data('room-code'); // Assuming you have a data attribute for room code
						var msg = "turn on"
						
						console.log(msg)
						
						console.log(roomCode)
						console.log(displayAddress)

						// Define the data you want to send to the API
						const dataToSend = {
							room_code: roomCode,
							display_address: displayAddress
						};

						$.ajax({
							url: `http:192.168.20.26/api/turn_on_projector/${roomCode}/${displayAddress}`,
							method: 'POST',
							data: JSON.stringify(dataToSend),
							contentType: 'application/json',
							success: function (response) {
								console.log(response);
								const responseElement = $(`#displayResponse_${displayAddress.replace(/\./g, '_')}`);
								responseElement.text(JSON.stringify(response, null, 2));
							},
							error: function (xhr, status, error) {
								console.error('Error: ' + error);
								const responseElement = $(`#displayResponse_${displayAddress.replace(/\./g, '_')}`);
								responseElement.text(JSON.stringify(error, null, 2));
							}
						});
					});
					
					$('#displayList').on('click', '.turnDisplayOff', function () {
						const displayAddress = $(this).data('host-id');
						const roomCode = $(this).data('room-code'); // Assuming you have a data attribute for room code
						var msg = "turn off"
						
						console.log(msg)
						console.log(roomCode)
						console.log(displayAddress)

						// Define the data you want to send to the API
						const dataToSend = {
							room_code: roomCode,
							display_address: displayAddress
						};

						$.ajax({
							url: `http:192.168.20.26/api/turn_off_projector/${roomCode}/${displayAddress}`,
							method: 'POST',
							data: JSON.stringify(dataToSend),
							contentType: 'application/json',
							success: function (response) {
								console.log(response);
								const responseElement = $(`#displayResponse_${displayAddress.replace(/\./g, '_')}`);
								responseElement.text(JSON.stringify(response, null, 2));
							},
							error: function (xhr, status, error) {
								console.error('Error: ' + error);
								const responseElement = $(`#displayResponse_${displayAddress.replace(/\./g, '_')}`);
								responseElement.text(JSON.stringify(error, null, 2));
							}
						});
					});
					
					$('#displayList').on('click', '.getDisplayStatus', function () {
						const displayAddress = $(this).data('host-id');
						const roomCode = $(this).data('room-code'); // Assuming you have a data attribute for room code
						var msg = "get status"
						
						console.log(msg)
						console.log(roomCode)
						console.log(displayAddress)

						// Define the data you want to send to the API
						const dataToSend = {
							room_code: roomCode,
							display_address: displayAddress
						};

						$.ajax({
							url: `http:192.168.20.26/api/get_projector_state/${roomCode}/${displayAddress}`,
							method: 'GET',
							data: JSON.stringify(dataToSend),
							contentType: 'application/json',
							success: function (response) {
								console.log(response);
								const responseElement = $(`#displayResponse_${displayAddress.replace(/\./g, '_')}`);
								responseElement.text(JSON.stringify(response, null, 2));
							},
							error: function (xhr, status, error) {
								console.error('Error: ' + error);
								const responseElement = $(`#displayResponse_${displayAddress.replace(/\./g, '_')}`);
								responseElement.text(JSON.stringify(error, null, 2));
							}
						});
					});

                    $('#hostList').empty();
					// Initialize an object to store host information with PIDs
                    roomInfo.hosts.forEach(host => {
						const hostId = host.host_id.replace(/\./g, '_');
                        $('#hostList').append(`
                            <li>${host.host_name} (ID: ${host.host_id})
                            <button class="Default" data-room-code="${roomCode}" data-host-id="${host.host_id}" data-config-default="${host.config_default}">Default</button>
                            <button class="Cisco" data-room-code="${roomCode}" data-host-id="${host.host_id}">Cisco</button>
                            <button class="Optus" data-room-code="${roomCode}" data-host-id="${host.host_id}">Optus</button>
                            <button class="Other" data-room-code="${roomCode}" data-host-id="${host.host_id}">Other</button>
							<button class="closeProcessButton" data-room-code="${roomCode}" data-host-id="${host.host_id}" data-host-pid="${hostData[host.host_id]}">Stop</button>
                            <pre class="response" id="hostResponse_${hostId}"></pre>
                            </li>
                        `);
                    });		
					
					$('#hostList').on('click', '.Default', function () {
						const hostAddress = $(this).data('host-id');
						//const content = $(this).data('config-default');
						const roomCode = $(this).data('room-code'); // Assuming you have a data attribute for room code
						var msg = "do default"
						
						console.log("1 " + msg)
						console.log("2 " + roomCode)
						console.log("3 " + hostAddress)
						console.log("4 " + content)
						
						var content = "https://www.youtube.com/watch?v=9_S_8MspxKw";

						if (content) {
							// Define the data you want to send to the API
							//const dataToSend = {
							//	"application": "vlc",
							//	"video_path": content,
							//	"loop": "true"
							//};
							
							const dataToSend = {
								"url": content,
							};

							$.ajax({
								url: `http:192.168.20.26/api/open_browser/${roomCode}/${hostAddress}`,
								method: 'POST',
								data: JSON.stringify(dataToSend),
								contentType: 'application/json',
								success: function (response) {
									console.log(response);
									 
									const pid = response.response;
									hostData[hostAddress] = pid;
									console.log("the hostData stored pid is: " + hostData[hostAddress]);
									
									
									const responseElement = $(`#hostResponse_${hostAddress.replace(/\./g, '_')}`);
									responseElement.text(JSON.stringify(pid, null, 2));
								},
								error: function (xhr, status, error) {
									console.error('Error: ' + error);
									const responseElement = $(`#hostResponse_${hostAddress.replace(/\./g, '_')}`);
									responseElement.text(JSON.stringify(error, null, 2));
								}
							});
						} else {
							console.log("Host missing config");
						}
					});
					
					// Example function for "Turn Display On" button click
					$('#hostList').on('click', '.Cisco', function () {
						const hostAddress = $(this).data('host-id');
						
						console.log(hostAddress);
						const response = $(`#hostResponse_${hostAddress.replace(/\./g, '_')}`);
						
						var msg = "cisco"

						// Update the response text box for this specific display
						response.text(JSON.stringify(msg, null, 2));
					});
					
					$('#hostList').on('click', '.Cisco', function () {
						const hostAddress = $(this).data('host-id');
						const content = $(this).data('config-cisco');
						const roomCode = $(this).data('room-code'); // Assuming you have a data attribute for room code
						var msg = "do default"
						
						console.log("1 " + msg)
						console.log("2 " + roomCode)
						console.log("3 " + hostAddress)
						console.log("4 " + content)

						if (content) {
							// Define the data you want to send to the API
							const dataToSend = {
								"application": "vlc",
								"video_path": content,
								"loop": "true"
							};

							$.ajax({
								url: `http:192.168.20.26/api/open_vlc_video/${roomCode}/${hostAddress}`,
								method: 'POST',
								data: JSON.stringify(dataToSend),
								contentType: 'application/json',
								success: function (response) {
									console.log(response);
									 
									const pid = response.response;
									hostData[hostAddress] = pid;
									console.log("the hostData stored pid is: " + hostData[hostAddress]);
									
									
									const responseElement = $(`#hostResponse_${hostAddress.replace(/\./g, '_')}`);
									responseElement.text(JSON.stringify(pid, null, 2));
								},
								error: function (xhr, status, error) {
									console.error('Error: ' + error);
									const responseElement = $(`#hostResponse_${hostAddress.replace(/\./g, '_')}`);
									responseElement.text(JSON.stringify(error, null, 2));
								}
							});
						} else {
							console.log("Host missing config");
						}
					});
					
					$('#hostList').on('click', '.Optus', function () {
						const hostAddress = $(this).data('host-id');
						const content = $(this).data('config-optus');
						const roomCode = $(this).data('room-code'); // Assuming you have a data attribute for room code
						var msg = "do default"
						
						console.log("1 " + msg)
						console.log("2 " + roomCode)
						console.log("3 " + hostAddress)
						console.log("4 " + content)

						if (content) {
							// Define the data you want to send to the API
							const dataToSend = {
								"application": "vlc",
								"video_path": content,
								"loop": "true"
							};

							$.ajax({
								url: `http:192.168.20.26/api/open_vlc_video/${roomCode}/${hostAddress}`,
								method: 'POST',
								data: JSON.stringify(dataToSend),
								contentType: 'application/json',
								success: function (response) {
									console.log(response);
									 
									const pid = response.response;
									hostData[hostAddress] = pid;
									console.log("the hostData stored pid is: " + hostData[hostAddress]);
									
									const responseElement = $(`#hostResponse_${hostAddress.replace(/\./g, '_')}`);
									responseElement.text(JSON.stringify(pid, null, 2));
								},
								error: function (xhr, status, error) {
									console.error('Error: ' + error);
									const responseElement = $(`#hostResponse_${hostAddress.replace(/\./g, '_')}`);
									responseElement.text(JSON.stringify(error, null, 2));
								}
							});
						} else {
							console.log("Host missing config");
						}
					});
					
					$('#hostList').on('click', '.Other', function () {
						const hostAddress = $(this).data('host-id');
						const content = $(this).data('config-other');
						const roomCode = $(this).data('room-code'); // Assuming you have a data attribute for room code
						var msg = "do default"
						
						console.log("1 " + msg)
						console.log("2 " + roomCode)
						console.log("3 " + hostAddress)
						console.log("4 " + content)

						if (content) {
							// Define the data you want to send to the API
							const dataToSend = {
								"application": "vlc",
								"video_path": content,
								"loop": "true"
							};

							$.ajax({
								url: `http:192.168.20.26/api/open_vlc_video/${roomCode}/${hostAddress}`,
								method: 'POST',
								data: JSON.stringify(dataToSend),
								contentType: 'application/json',
								success: function (response) {
									console.log(response);
									 
									const pid = response.response;
									hostData[hostAddress] = pid;
									console.log("the hostData stored pid is: " + hostData[hostAddress]);
																
									const responseElement = $(`#hostResponse_${hostAddress.replace(/\./g, '_')}`);
									responseElement.text(JSON.stringify(pid, null, 2));
								},
								error: function (xhr, status, error) {
									console.error('Error: ' + error);
									const responseElement = $(`#hostResponse_${hostAddress.replace(/\./g, '_')}`);
									responseElement.text(JSON.stringify(error, null, 2));
								}
							});
						} else {
							console.log("Host missing config");
						}
					});
					
					$('#hostList').on('click', '.closeProcessButton', function () {
						const hostAddress = $(this).data('host-id');
						const roomCode = $(this).data('room-code');

						// Retrieve the PID from hostData
						const pid = hostData[hostAddress];
						
						console.log("in closeProcessButton, pid is: " + pid)

						if (pid) {
							const dataToSend = {
								"pid": pid
							};

							$.ajax({
								url: `http://192.168.20.26/api/close_process/${roomCode}/${hostAddress}`,
								method: 'POST',
								data: JSON.stringify(dataToSend),
								contentType: 'application/json',
								success: function (response) {
									console.log(response);
									const responseElement = $(`#hostResponse_${hostAddress.replace(/\./g, '_')}`);
									responseElement.text(JSON.stringify(response, null, 2));
								},
								error: function (xhr, status, error) {
									console.error('Error: ' + error);
									const responseElement = $(`#hostResponse_${hostAddress.replace(/\./g, '_')}`);
									responseElement.text(JSON.stringify(error, null, 2));
								}
							});
						} else {
							console.log("No PID found for this host. Cannot stop the process.");
						}
					});

                    $('#pduList').empty();
                    roomInfo.pdus.forEach(pdu => {
						const pduId = pdu.pdu_address.replace(/\./g, '_');
                        $('#pduList').append(`
                            <li>${pdu.pdu_address}
                            <button class="turnPduOnButton" data-room-code="${roomCode}" data-pdu-address="${pdu.pdu_address}">Turn On</button>
                            <button class="turnPduOffButton" data-room-code="${roomCode}" data-pdu-address="${pdu.pdu_address}">Turn Off</button>
                            <button class="powerCyclePduButton" data-room-code="${roomCode}" data-pdu-address="${pdu.pdu_address}">Power Cycle</button>
                            <pre class="response" id="pduResponse_${pduId}"></pre>
                            </li>
                        `);
                    });
					
					$('#pduList').on('click', '.turnPduOnButton', function () {
						const pduAddress = $(this).data('pdu-address');
						const roomCode = $(this).data('room-code');
						
						console.log(roomCode)
						console.log(hostAddress)
						
						var msg = "turn pdu outlet on"
						console.log(msg)

						// Define the data you want to send to the API
						const dataToSend = {
							room_code: roomCode,
							display_address: displayAddress
						};

						$.ajax({
							url: `http:192.168.20.26/api/turn_on_projector/${roomCode}/${pduAddress}`,
							method: 'POST',
							data: JSON.stringify(dataToSend),
							contentType: 'application/json',
							success: function (response) {
								console.log(response);
								const responseElement = $(`#displayResponse_${displayAddress.replace(/\./g, '_')}`);
								responseElement.text(JSON.stringify(response, null, 2));
							},
							error: function (xhr, status, error) {
								console.error('Error: ' + error);
								const responseElement = $(`#displayResponse_${displayAddress.replace(/\./g, '_')}`);
								responseElement.text(JSON.stringify(error, null, 2));
							}
						});
					});
					
					$('#pduList').on('click', '.turnPduOnButton', function () {
						const hostAddress = $(this).data('pdu-address');
						
						var msg = "pdu turn on"
						
						console.log(msg)
						
						console.log(roomCode)
						console.log(hostAddress)

						// Define the data you want to send to the API
						const dataToSend = {
							room_code: roomCode,
							display_address: displayAddress
						};

						$.ajax({
							url: `http:192.168.20.26/api/turn_on_projector/${roomCode}/${displayAddress}`,
							method: 'POST',
							data: JSON.stringify(dataToSend),
							contentType: 'application/json',
							success: function (response) {
								console.log(response);
								const responseElement = $(`#displayResponse_${displayAddress.replace(/\./g, '_')}`);
								responseElement.text(JSON.stringify(response, null, 2));
							},
							error: function (xhr, status, error) {
								console.error('Error: ' + error);
								const responseElement = $(`#displayResponse_${displayAddress.replace(/\./g, '_')}`);
								responseElement.text(JSON.stringify(error, null, 2));
							}
						});
					});

					$('#pduList').on('click', '.turnPduOffButton', function () {
						const hostAddress = $(this).data('pdu-address');
						
						console.log(hostAddress);
						const response = $(`#pduResponse_${hostAddress.replace(/\./g, '_')}`);
						
						var msg = "turn pdu off"

						// Update the response text box for this specific display
						response.text(JSON.stringify(msg, null, 2));
					});
					
					$('#pduList').on('click', '.powerCyclePduButton', function () {
						const hostAddress = $(this).data('pdu-address');
						
						console.log(hostAddress);
						const response = $(`#pduResponse_${hostAddress.replace(/\./g, '_')}`);
						
						var msg = "power cycle pdu"

						// Update the response text box for this specific display
						response.text(JSON.stringify(msg, null, 2));
					});
					
					
                },
                error: function (xhr, status, error) {
                    console.log('Error fetching room info:', error);
                }
            });
        }

        


        // Example function for "Turn Display Off" button click
		$('#displayList').on('click', '.turnDisplayOff', function () {
			const displayAddress = $(this).data('host-id');
			console.log(displayAddress);

			// Update the response text box
			const responseDiv = $(`#displayResponse_${displayAddress}`);
			responseDiv.text('Turn Display Off: ' + displayAddress);
		});

        // Example function for "Get Display Status" button click
        $('#displayList').on('click', '.getDisplayStatus', function () {
			const displayAddress = $(this).data('host-id');
			console.log(displayAddress);

			// Update the response text box
			const responseDiv = $(`#displayResponse_${displayAddress}`);
			responseDiv.text('Pressed');
		});

        // Add similar functions for other button categories like "Default," "Cisco," "Optus," etc.

        $.ajax({
            url: base_url + '/api/get_rooms',
            method: 'GET',
            success: function (response) {
                const rooms = response.rooms;
                populateRoomList(rooms);

                $('.roomButton').on('click', function () {
                    const selectedRoomCode = $(this).data('room-code');
                    updateRoomInfo(selectedRoomCode);
                });
            },
            error: function (xhr, status, error) {
                console.log('Error fetching room list:', error);
            }
        });
    });
    </script>

</body>
</html>
